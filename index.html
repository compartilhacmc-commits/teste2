<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Diretoria de Regulação do Acesso – CMC</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pt.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    /* Estilos adicionais para os novos gráficos - para adicionar ao seu style.css existente */
    .charts-row-3cols {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-top: 20px;
    }
    
    .charts-row-2cols {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-top: 20px;
    }
    
    .percentage-value {
      font-size: 0.9rem;
      font-weight: 700;
      color: var(--primary);
      margin-left: 5px;
    }
    
    .percentage-badge {
      display: inline-block;
      background: rgba(74,144,217,0.1);
      border-radius: 12px;
      padding: 3px 8px;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--primary-dark);
    }
    
    .percentage-badge.high {
      background: rgba(231,76,60,0.15);
      color: #c0392b;
    }
    
    .dot-red {
      background: #e74c3c;
      box-shadow: 0 0 0 3px rgba(231,76,60,0.2);
    }
    
    @media (max-width: 1100px) {
      .charts-row-3cols { grid-template-columns: repeat(2, 1fr); }
      .charts-row-2cols { grid-template-columns: 1fr; }
    }
    
    @media (max-width: 768px) {
      .charts-row-3cols { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <!-- ===================== HEADER ===================== -->
  <header class="header">
    <div class="header-inner">
      <div class="header-logo">
        <div class="header-icon">
          <i class="fas fa-hospital-user"></i>
        </div>
        <div class="header-titles">
          <h1 class="header-main">DIRETORIA DE REGULAÇÃO DO ACESSO</h1>
          <h2 class="header-sub">CONSOLIDADO/AGENDAMENTOS 2026</h2>
          <h3 class="header-sub2">CENTRAL DE MARCAÇÃO DE CONSULTAS</h3>
          <p class="header-ref">Referência do Setor: <strong>Enfermeira Giovanna</strong></p>
          <p class="header-creator">Página criada por <strong>Ana P. A. Silva</strong> – Matric. 201704 | Assistente Adm. Diretoria de Regulação do Acesso</p>
        </div>
      </div>
      <div class="header-actions">
        <div class="status-badge">
          <span class="status-dot"></span>
          <span id="statusText">Conectando...</span>
        </div>
        <button class="btn btn-refresh" id="btnRefresh" onclick="loadData()">
          <i class="fas fa-sync-alt" id="refreshIcon"></i> Atualizar
        </button>
        <button class="btn btn-excel" id="btnExcel" onclick="exportExcel()">
          <i class="fas fa-file-excel"></i> Excel
        </button>
      </div>
    </div>
  </header>

  <!-- ===================== LOADING ===================== -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="loading-box">
      <div class="spinner"></div>
      <p>Carregando dados...</p>
    </div>
  </div>

  <!-- ===================== MAIN CONTENT ===================== -->
  <main class="main-content">

    <!-- ===== FILTROS ===== -->
    <section class="filters-section card">
      <div class="filters-header">
        <i class="fas fa-filter"></i>
        <span>Filtros</span>
        <button class="btn-clear-filters" onclick="clearFilters()">
          <i class="fas fa-times"></i> Limpar filtros
        </button>
      </div>
      <div class="filters-grid">

        <div class="filter-group">
          <label><i class="fas fa-calendar-alt"></i> Total de agendamentos no mês</label>
          <select id="filterMes" class="filter-select" onchange="applyFilters()">
            <option value="">Todos</option>
          </select>
        </div>

        <div class="filter-group">
          <label><i class="fas fa-building"></i> Prestador</label>
          <select id="filterPrestador" class="filter-select" onchange="applyFilters()">
            <option value="">Todos</option>
          </select>
        </div>

        <div class="filter-group">
          <label><i class="fas fa-stethoscope"></i> Especialidade</label>
          <select id="filterEspecialidade" class="filter-select" onchange="applyFilters()">
            <option value="">Todas</option>
          </select>
        </div>

        <div class="filter-group">
          <label><i class="fas fa-notes-medical"></i> Tipo de Serviço</label>
          <select id="filterTipoServico" class="filter-select" onchange="applyFilters()">
            <option value="">Todos</option>
            <option value="Primeira Consulta">Primeira Consulta</option>
            <option value="Retorno">Retorno</option>
          </select>
        </div>

        <div class="filter-group">
          <label><i class="fas fa-user-md"></i> Profissional Médico</label>
          <select id="filterProfissional" class="filter-select" onchange="applyFilters()">
            <option value="">Todos</option>
          </select>
        </div>

        <div class="filter-group">
          <label><i class="fas fa-calendar-day"></i> Data da Criação do Agendamento</label>
          <div class="date-wrapper">
            <input type="text" id="filterDataInicio" class="filter-input date-input" placeholder="dd/mm/aaaa" readonly />
            <i class="fas fa-calendar-check date-icon"></i>
          </div>
        </div>

        <div class="filter-group">
          <label><i class="fas fa-clinic-medical"></i> Unidade de Saúde</label>
          <select id="filterUnidade" class="filter-select" onchange="applyFilters()">
            <option value="">Todas</option>
          </select>
        </div>

        <div class="filter-group">
          <label><i class="fas fa-map-marker-alt"></i> Distrito</label>
          <select id="filterDistrito" class="filter-select" onchange="applyFilters()">
            <option value="">Todos</option>
          </select>
        </div>

        <div class="filter-group">
          <label><i class="fas fa-flag"></i> Situação</label>
          <select id="filterSituacao" class="filter-select" onchange="applyFilters()">
            <option value="">Todas</option>
            <option value="AGE">Agendados</option>
            <option value="CAN">Cancelados</option>
            <option value="FAL">Faltosos</option>
            <option value="REC">Recepcionados</option>
            <option value="TRA">Transferidos</option>
          </select>
        </div>

      </div>
    </section>

    <!-- ===== KPI CARDS ===== -->
    <section class="kpi-section">
      <div class="kpi-card kpi-total">
        <div class="kpi-icon"><i class="fas fa-calendar-check"></i></div>
        <div class="kpi-info">
          <p class="kpi-label">Total Agendamentos (exceto CAN)</p>
          <h3 class="kpi-value" id="kpiTotal">0</h3>
        </div>
      </div>
      <div class="kpi-card kpi-agendado">
        <div class="kpi-icon"><i class="fas fa-check-circle"></i></div>
        <div class="kpi-info">
          <p class="kpi-label">Agendados (AGE)</p>
          <h3 class="kpi-value" id="kpiAgendados">0</h3>
        </div>
      </div>
      <div class="kpi-card kpi-recepcionado">
        <div class="kpi-icon"><i class="fas fa-user-check"></i></div>
        <div class="kpi-info">
          <p class="kpi-label">Recepcionados (REC)</p>
          <h3 class="kpi-value" id="kpiRecepcionados">0</h3>
        </div>
      </div>
      <div class="kpi-card kpi-faltoso">
        <div class="kpi-icon"><i class="fas fa-user-times"></i></div>
        <div class="kpi-info">
          <p class="kpi-label">Faltosos (FAL)</p>
          <h3 class="kpi-value" id="kpiFaltosos">0</h3>
        </div>
      </div>
      <div class="kpi-card kpi-cancelado">
        <div class="kpi-icon"><i class="fas fa-times-circle"></i></div>
        <div class="kpi-info">
          <p class="kpi-label">Cancelados (CAN)</p>
          <h3 class="kpi-value" id="kpiCancelados">0</h3>
        </div>
      </div>
      <div class="kpi-card kpi-transferido">
        <div class="kpi-icon"><i class="fas fa-exchange-alt"></i></div>
        <div class="kpi-info">
          <p class="kpi-label">Transferidos (TRA)</p>
          <h3 class="kpi-value" id="kpiTransferidos">0</h3>
        </div>
      </div>
    </section>

    <!-- ===== GRÁFICOS LINHA 1 (TROCADOS) ===== -->
    <section class="charts-row">
      <div class="chart-card chart-wide">
        <div class="chart-header">
          <div class="chart-title-group">
            <div class="chart-dot dot-orange"></div>
            <h4>Agendamentos por Distrito (Conforme o Filtro)</h4>
          </div>
          <span class="chart-badge">Barras Verticais</span>
        </div>
        <div class="chart-body">
          <canvas id="chartDistrito"></canvas>
        </div>
      </div>

      <div class="chart-card chart-small">
        <div class="chart-header">
          <div class="chart-title-group">
            <div class="chart-dot dot-blue"></div>
            <h4>Agendamentos por Prestador (Conforme o Filtro)</h4>
          </div>
          <span class="chart-badge">Barras Verticais</span>
        </div>
        <div class="chart-body">
          <canvas id="chartPrestador"></canvas>
        </div>
      </div>
    </section>

    <!-- ===== GRÁFICOS LINHA 2 ===== -->
    <section class="charts-row">
      <div class="chart-card chart-half">
        <div class="chart-header">
          <div class="chart-title-group">
            <div class="chart-dot dot-purple"></div>
            <h4>Agendamentos por Especialidade (Conforme o Filtro)</h4>
          </div>
          <span class="chart-badge">Barras Horizontais</span>
        </div>
        <div class="chart-body chart-body-tall">
          <canvas id="chartEspecialidade"></canvas>
        </div>
      </div>

      <div class="chart-card chart-half">
        <div class="chart-header">
          <div class="chart-title-group">
            <div class="chart-dot dot-teal"></div>
            <h4>Consolidado por Situação</h4>
          </div>
          <span class="chart-badge">Rosca</span>
        </div>
        <div class="chart-body">
          <canvas id="chartSituacao"></canvas>
        </div>
      </div>
    </section>

    <!-- ===== GRÁFICOS LINHA 3 (MÊS EM ROSCA) ===== -->
    <section class="charts-row">
      <div class="chart-card chart-full">
        <div class="chart-header">
          <div class="chart-title-group">
            <div class="chart-dot dot-green"></div>
            <h4>Distribuição de Agendamentos por Mês (Conforme o Filtro)</h4>
          </div>
          <span class="chart-badge">Gráfico de Rosca</span>
        </div>
        <div class="chart-body" style="min-height: 350px;">
          <canvas id="chartMesRosca"></canvas>
        </div>
      </div>
    </section>

    <!-- ===== NOVOS GRÁFICOS: ABSENTEÍSMO E CANCELAMENTOS ===== -->
    <section class="charts-row-3cols">
      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title-group">
            <div class="chart-dot dot-orange"></div>
            <h4>% Absenteísmo por Distrito</h4>
          </div>
          <span class="chart-badge">Barras</span>
        </div>
        <div class="chart-body" style="min-height: 280px;">
          <canvas id="chartAbsentDistrito"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title-group">
            <div class="chart-dot dot-purple"></div>
            <h4>% Absenteísmo por Especialidade</h4>
          </div>
          <span class="chart-badge">Barras</span>
        </div>
        <div class="chart-body" style="min-height: 280px;">
          <canvas id="chartAbsentEspecialidade"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title-group">
            <div class="chart-dot dot-blue"></div>
            <h4>1ª Consulta vs Retorno</h4>
          </div>
          <span class="chart-badge">Barras</span>
        </div>
        <div class="chart-body" style="min-height: 280px;">
          <canvas id="chartTipoAtendimento"></canvas>
        </div>
      </div>
    </section>

    <section class="charts-row-2cols">
      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title-group">
            <div class="chart-dot dot-red"></div>
            <h4>% Cancelamentos por Distrito</h4>
          </div>
          <span class="chart-badge">Barras</span>
        </div>
        <div class="chart-body" style="min-height: 280px;">
          <canvas id="chartCancelDistrito"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title-group">
            <div class="chart-dot dot-red"></div>
            <h4>% Cancelamentos por Especialidade</h4>
          </div>
          <span class="chart-badge">Barras</span>
        </div>
        <div class="chart-body" style="min-height: 280px;">
          <canvas id="chartCancelEspecialidade"></canvas>
        </div>
      </div>
    </section>

    <!-- ===== NOVA TABELA CONSOLIDADO/AGENDAMENTOS ===== -->
    <section class="table-section card">
      <div class="table-header">
        <div class="table-title-group">
          <i class="fas fa-table"></i>
          <h4>CONSOLIDADO/AGENDAMENTOS</h4>
        </div>
        <div class="table-controls">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="tableSearch" placeholder="Buscar registros..." oninput="filterTable()" />
          </div>
          <select id="tablePageSize" class="filter-select small-select" onchange="renderTable()">
            <option value="15">15 por página</option>
            <option value="25">25 por página</option>
            <option value="50">50 por página</option>
            <option value="100">100 por página</option>
            <option value="500">500 por página</option>
            <option value="1000">1.000 por página</option>
          </select>
        </div>
      </div>

      <div class="table-responsive">
        <table class="data-table" id="mainTable">
          <thead>
            <tr>
              <th onclick="sortTable(0)">Distrito <i class="fas fa-sort"></i></th>
              <th onclick="sortTable(1)">Unidade Solicitante <i class="fas fa-sort"></i></th>
              <th onclick="sortTable(2)">Tipo de Serviço <i class="fas fa-sort"></i></th>
              <th onclick="sortTable(3)">CBO/Especialidade <i class="fas fa-sort"></i></th>
              <th onclick="sortTable(4)">Unidade Executante <i class="fas fa-sort"></i></th>
              <th class="text-center">AGE</th>
              <th class="text-center">REC</th>
              <th class="text-center">FAL</th>
              <th class="text-center">CAN</th>
              <th class="text-center">TRA</th>
              <th onclick="sortTable(10)" class="text-center">Total Agendamentos <i class="fas fa-sort"></i></th>
              <th onclick="sortTable(11)" class="text-center">% Absenteísmo <i class="fas fa-sort"></i></th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr><td colspan="12" class="empty-msg">Aguardando dados...</td></tr>
          </tbody>
          <tfoot id="tableFoot"></tfoot>
        </table>
      </div>

      <div class="table-footer">
        <span id="tablePaginationInfo">Mostrando 0 registros</span>
        <div class="pagination" id="pagination"></div>
      </div>
    </section>

  </main>

  <!-- ===================== FOOTER ===================== -->
  <footer class="footer">
    <p>Diretoria de Regulação do Acesso – Prefeitura Municipal de Contagem | Desenvolvido por Ana P. A. Silva – Matric. 201704</p>
    <p id="lastUpdate">Última atualização: –</p>
  </footer>

  <script src="script.js"></script>
</body>
</html>
